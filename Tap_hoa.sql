CREATE DATABASE Tap_Hoa
USE Tap_Hoa
 
CREATE TABLE HANG_HOA
(
MAHH VARCHAR(4) PRIMARY KEY,
TENHH VARCHAR(255),
DVT VARCHAR(10),
DONGIA INT
)
 
CREATE TABLE BAN_HANG
(
SOHD VARCHAR(4),
MAHH VARCHAR(4) REFERENCES HANG_HOA(MAHH),
MANV VARCHAR(4) REFERENCES NHAN_VIEN(MANV),
SLBAN INT,
PRIMARY KEY(SOHD, MAHH, MANV)
)
 
CREATE TABLE NHAN_VIEN
(
MANV VARCHAR(4) PRIMARY KEY,
HOTENNV VARCHAR(255),
GIOITINH BIT,
DINHMUC INT
)
 
INSERT INTO HANG_HOA(MAHH, TENHH, DVT, DONGIA) VALUES ('MH01', 'Romano', 'Chai', 45000);
INSERT INTO HANG_HOA(MAHH, TENHH, DVT, DONGIA) VALUES ('MH02', 'Johnson', 'Chai', 55000);
INSERT INTO HANG_HOA(MAHH, TENHH, DVT, DONGIA) VALUES ('MH03', 'Enchenter', 'Chai', 35000);
INSERT INTO HANG_HOA(MAHH, TENHH, DVT, DONGIA) VALUES ('MH04', 'Clear', 'Chai', 65000);
INSERT INTO HANG_HOA(MAHH, TENHH, DVT, DONGIA) VALUES ('MH05', 'Double Rich', 'Chai', 60000);
 
SELECT * FROM HANG_HOA;
 
INSERT INTO NHAN_VIEN(MANV, HOTENNV, GIOITINH, DINHMUC) VALUES ('NV01', N'Nguy?n ??c Th?ng', 1, 70);
INSERT INTO NHAN_VIEN(MANV, HOTENNV, GIOITINH, DINHMUC) VALUES ('NV02', N'V? Th? H?nh', 0, 60);
INSERT INTO NHAN_VIEN(MANV, HOTENNV, GIOITINH, DINHMUC) VALUES ('NV03', N'Phan Thanh Tâm', 1, 80);
INSERT INTO NHAN_VIEN(MANV, HOTENNV, GIOITINH, DINHMUC) VALUES ('NV04', N'Nguy?n Kim ??c', 1, 100);
INSERT INTO NHAN_VIEN(MANV, HOTENNV, GIOITINH, DINHMUC) VALUES ('NV05', N'Nguy?n TR?ng Tu?', 1, 90);
 
SELECT * FROM NHAN_VIEN;
 
INSERT INTO BAN_HANG(SOHD, MAHH, MANV, SLBAN) VALUES ('X001', 'MH01', 'NV01', 120);
INSERT INTO BAN_HANG(SOHD, MAHH, MANV, SLBAN) VALUES ('X001', 'MH01', 'NV05', 390);
INSERT INTO BAN_HANG(SOHD, MAHH, MANV, SLBAN) VALUES ('X002', 'MH02', 'NV02', 150);
INSERT INTO BAN_HANG(SOHD, MAHH, MANV, SLBAN) VALUES ('X002', 'MH02', 'NV04', 360);
INSERT INTO BAN_HANG(SOHD, MAHH, MANV, SLBAN) VALUES ('X003', 'MH03', 'NV03', 80);
INSERT INTO BAN_HANG(SOHD, MAHH, MANV, SLBAN) VALUES ('X003', 'MH03', 'NV04', 180);
INSERT INTO BAN_HANG(SOHD, MAHH, MANV, SLBAN) VALUES ('X004', 'MH04', 'NV02', 300);
INSERT INTO BAN_HANG(SOHD, MAHH, MANV, SLBAN) VALUES ('X004', 'MH04', 'NV03', 210);
INSERT INTO BAN_HANG(SOHD, MAHH, MANV, SLBAN) VALUES ('X005', 'MH05', 'NV01', 70);
INSERT INTO BAN_HANG(SOHD, MAHH, MANV, SLBAN) VALUES ('X005', 'MH05', 'NV05', 90);
 
SELECT * FROM BAN_HANG;
--1. Liêt kê danh sách nhân viên bán hàng g?m các c?t d? li?u sau: MANV, HOTENNV, PHAI, MAHH, TENHH, DINHMUC, SLBAN, DONGIA, THANHTIEN. 
--Trong ?ó c?t PHAI ph?i tr? v? giá tr? “Nam”, “N?” 
SELECT NV.MANV, NV.HOTENNV,HH.MAHH, HH.TENHH, NV.DINHMUC, BH.SLBAN, HH.DONGIA, (BH.SLBAN * HH.DONGIA) AS THANHTIEN,
	CASE
    	WHEN NV.GIOITINH = 1 THEN N'Nam'
    	ELSE N'N?'
	END AS PHAI
FROM
	NHAN_VIEN AS NV
JOIN
	BAN_HANG AS BH ON NV.MANV = BH.MANV
JOIN
	HANG_HOA AS HH ON BH.MAHH = HH.MAHH;
--2. Liêt kê danh sách nhân viên bán hàng có h? “Nguy?n”g?m các c?t d? li?u sau: MANV, HOTENNV, MAHH, TENHH, DINHMUC, SLBAN, DONGIA, THANHTIEN.
SELECT NV.MANV, NV.HOTENNV,HH.MAHH, HH.TENHH, NV.DINHMUC, BH.SLBAN, HH.DONGIA, (BH.SLBAN * HH.DONGIA) AS THANHTIEN
FROM NHAN_VIEN AS NV
JOIN
BAN_HANG AS BH ON NV.MANV = BH.MANV
JOIN
HANG_HOA AS HH ON BH.MAHH = HH.MAHH
WHERE NV.HOTENNV LIKE N'NGUY?N%';
--3. Li?t kê danh sách các m?t hàng bán v??t ??nh m?c g?m các c?t d? li?u sau: MANV, HOTENNV, MAHH, TENHH, DINHMUC, SLBAN, DONGIA, THANHTIEN 
SELECT NV.MANV, NV.HOTENNV,HH.MAHH, HH.TENHH, NV.DINHMUC, BH.SLBAN, HH.DONGIA, (BH.SLBAN * HH.DONGIA) AS THANHTIEN
FROM NHAN_VIEN NV
JOIN
	BAN_HANG BH ON NV.MANV = BH.MANV
JOIN
	HANG_HOA HH ON BH.MAHH = HH.MAHH
WHERE BH.SLBAN > NV.DINHMUC;
--4. Th?ng kê t?ng s? l??ng các m?t hàng g?m các c?t d? li?u sau: MAHH, TENHH, TONGSOLUONG 
SELECT HH.MAHH, HH.TENHH, Sum (BH.SLBAN) as TONGSOLUONG
from HANG_HOA HH
JOIN BAN_HANG BH ON BH.MAHH = HH.MAHH
GROUP BY HH.MAHH, HH.TENHH;
--5. Th?ng kê t?ng thành ti?n các m?t hàng bán v??t ??nh m?c
SELECT HH.MAHH, HH.TENHH, SUM (BH.SLBAN * HH.DONGIA) AS TONG_THANHTIEN
FROM NHAN_VIEN NV
JOIN
	BAN_HANG BH ON NV.MANV = BH.MANV
JOIN
	HANG_HOA HH ON BH.MAHH = HH.MAHH
WHERE BH.SLBAN > NV.DINHMUC
GROUP BY HH.MAHH, HH.TENHH;
--8. Thay ??i ??n v? tính c?a mã hàng MH01, MH04 thành “Bình” 
UPDATE HANG_HOA
SET DVT = 'Bình'
WHERE MAHH IN ('MH01', 'MH04');
--9. Thay ??i ??n giá c?a mã hàng MH01, MH03, MH05, trong ?ó MH01 t?ng 5%, MH03 gi?m 2% và MH05 t?ng 7%. 
UPDATE HANG_HOA
SET DONGIA =
	CASE
    	WHEN MAHH = 'MH01' THEN DONGIA * 1.05
    	WHEN MAHH = 'MH03' THEN DONGIA * 0.98
    	WHEN MAHH = 'MH05' THEN DONGIA * 1.07
    	ELSE DONGIA
	END
WHERE MAHH IN ('MH01', 'MH03', 'MH05');
--10. Th?ng kê s? l??ng bán c?a các nhân viên
SELECT NV.MANV, NV.HOTENNV, SUM (BH.SLBAN) AS TONG_SLBAN
FROM NHAN_VIEN NV
JOIN
	BAN_HANG BH ON NV.MANV = BH.MANV
GROUP BY NV.MANV, NV.HOTENNV;
